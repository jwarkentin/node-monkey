/*! For license information please see monkey.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NodeMonkey=t():e.NodeMonkey=t()}(self,(function(){return(()=>{"use strict";var __webpack_modules__={"./src/client/convert-styles.js":(e,t,o)=>{o.r(t),o.d(t,{default:()=>l});var n=o("./src/client/utils.js"),r={"[24m":"text-decoration: none","[22m":"font-weight: normal","[1m":"font-weight: bold","[3m":"font-style: italic","[4m":"text-decoration: underline","[23m":"font-style: normal","[39m":"color: ","[37m":"color: white","[90m":"color: grey","[30m":"color: black","[35m":"color: magenta","[33m":"color: yellow","[31m":"color: red","[36m":"color: cyan","[34m":"color: blue","[32m":"color: green"},c=/(\u001b\[.*?m)+/g,_=/(?:^|[^%])%(s|d|i|o|f|c)/g;const l=function(e,t){e.length||e.push("");var o,l=1,i=[];n.default.isObject(e[0])&&(e.splice(1,0,e[0]),e[0]="%o");for(var a=e[0];o=_.exec(a);)"o"==o[1]&&(e[0]=e[0].replace(o[0],o[0].slice(0,o[0].length-2)+"[39m%o")),l++;if(e.length>l)for(var u=l;u<e.length;u++){var s=e[u],f=void 0;"string"==typeof s?(f=" "+s,e.splice(u,1),u--):f=" [39m%o",e[0]+=f}for(;o=_.exec(e[0]);)i.push(o);var p=0;for(a=e[0];o=c.exec(a);){for(var m=[],d=o[0].split("m"),b=0;b<d.length;b++){var y;(y=r[d[b]+"m"])&&m.push(y)}if(m.length){var v=void 0;for(v=0;v<i.length;v++){var h=i[v];if(o.index<h.index)break}var g=v+1+p;e.splice(g,0,m.join(";")),p++,e[0]=e[0].replace(o[0],"%c")}}return t&&(e[0]+="%c"+t,e.push("color: grey; font-family: Helvetica, Arial, sans-serif")),e}},"./src/client/utils.js":(e,t,o)=>{o.r(t),o.d(t,{default:()=>r});var n=o("./src/lib/common-utils.js");const r=Object.assign({getClientHost:function(){for(var e=document.getElementsByTagName("script"),t=/\/monkey\.js/,o=null,n=e.length-1;n>=0;--n)if(t.test(e[n].src)){o=e[n];break}if(o){var r=document.createElement("a");return r.href=o.src,"".concat(r.protocol,"//").concat(r.host)}return"".concat(location.protocol,"//").concat(location.host)},addHeadScript:function(e){var t=document.createElement("script");return t.type="text/javascript",t.src=e,document.getElementsByTagName("head")[0].appendChild(t),t}},n.default)},"./src/lib/common-utils.js":(e,t,o)=>{o.r(t),o.d(t,{default:()=>r});var n=o("./node_modules/@babel/runtime/helpers/esm/typeof.js");const r={isObject:function(e){var t=(0,n.default)(e);return!!e&&("object"==t||"function"==t)},invert:function(e){var t={};for(var o in e)e.hasOwnProperty(o)&&(t[e[o]]=o);return t}}},"./src/lib/cycle.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/typeof.js"),origJSON=__webpack_require__.g.JSON,JSON={};const __WEBPACK_DEFAULT_EXPORT__=JSON;"function"!=typeof JSON.decycle&&(JSON.decycle=function(e,t){var o=[],n=[];return function e(r,c){var _,l;return void 0!==t&&(r=t(r)),"object"!==(0,_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__.default)(r)||null===r||r instanceof Boolean||r instanceof Date||r instanceof Number||r instanceof RegExp||r instanceof String?r:(_=o.indexOf(r))>=0?{$ref:n[_]}:(o.push(r),n.push(c),Array.isArray(r)?(l=[],r.forEach((function(t,o){l[o]=e(t,c+"["+o+"]")}))):(l={},Object.keys(r).forEach((function(t){l[t]=e(r[t],c+"["+JSON.stringify(t)+"]")}))),l)}(e,"$")}),"function"!=typeof JSON.retrocycle&&(JSON.retrocycle=function retrocycle($){var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return function rez(value){value&&"object"===(0,_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__.default)(value)&&(Array.isArray(value)?value.forEach((function(element,i){if("object"===(0,_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__.default)(element)&&null!==element){var path=element.$ref;"string"==typeof path&&px.test(path)?value[i]=eval(path):rez(element)}})):Object.keys(value).forEach((function(name){var item=value[name];if("object"===(0,_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__.default)(item)&&null!==item){var path=item.$ref;"string"==typeof path&&px.test(path)?value[name]=eval(path):rez(item)}})))}($),$}),JSON=origJSON},"./node_modules/@babel/runtime/helpers/esm/typeof.js":(e,t,o)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}o.r(t),o.d(t,{default:()=>n})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](o,o.exports,__webpack_require__),o.exports}__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__);var e=__webpack_require__("./src/client/utils.js"),t=__webpack_require__("./src/lib/cycle.js"),o=__webpack_require__("./src/client/convert-styles.js"),n=!1,r=window.monkey={cmdId:0,runningCmd:{},connect:null,disconnect:null,init:function(){if(!n)return n=!0,new Promise((function(n,c){e.default.addHeadScript("".concat(e.default.getClientHost(),"/socket.io/socket.io.js")).addEventListener("load",(function(){new Promise((function(e,t){var o=io("".concat(location.origin,"/nm"));o.on("connect",(function(){})),o.on("error",(function(e){console.error(e)})),o.on("connect_error",(function(e){console.error(e)})),o.on("reconnect_error",(function(e){console.error(e)})),o.on("connect_timeout",(function(){console.error(new Error("Socket.IO connection timed out"))})),e(o)})).then((function(e){var c=0,_=null,l=o.default,i={convertStyles:!0};r.client=e,r.connect=e.connect.bind(e),r.disconnect=function(){c=0,_=null,e.disconnect.call(e)};var a=function(){var t,o;c>2?r.disconnect():(_||(t=prompt("Node Monkey username"),o=prompt("Node Monkey password"),_={username:t,password:o}),++c,e.emit("auth",_))};e.on("cmdResponse",(function(e,t,o){if(r.runningCmd[e]){var n=r.runningCmd[e],c=n.resolve,_=n.reject;delete r.runningCmd[e],t?_(t):c(o)}})),e.on("settings",(function(e){Object.assign(i,e),i.convertStyles||(l=function(e,t){return e.concat([t])})})),e.on("auth",a),e.on("authResponse",(function(e,t){e||(_=null,console.warn("Auth failed:",t),a())})),e.on("console",(function(e){var o,n=(e=t.default.retrocycle(e)).callerInfo;n&&(o=" -- Called from "+n.file+":"+n.line+":"+n.column+(n.caller?"(function "+n.caller+")":"")),"dir"===e.method?(console.dir(e.args[0]),o&&console.log.apply(console,l(["^^^"],o))):console[e.method].apply(console,l(e.args,o))})),e.on("prompt",(function(t,o,n){n||(n={}),e.emit("promptResponse",t,prompt(o))})),n()})).catch(c)}))}));r.connect()},cmd:function(e,t){if(r.client){var o=new Promise((function(t,o){var n=r.cmdId++;r.client.emit("cmd",n,e),r.runningCmd[n]={resolve:t,reject:o}}));return t||o.then((function(e){return null!==e&&console.log(e)})).catch((function(e){null!==e&&(console.error(e),alert(e.message))})),o}console.error("Must be connected to a server to execute a command")}}})(),__webpack_exports__=__webpack_exports__.default,__webpack_exports__})()}));
//# sourceMappingURL=monkey.js.map